{% extends 'webui/base.html' %}

{% load static %}

{% block extrahead %}
{{ liquidsoap_status|json_script:'liquidsoap-status-json' }}
<script src="{% static 'webui/js/jquery.min.js' %}"></script>
<script src="{% static 'webui/js/handlebars.min.js' %}"></script>
<script src="{% static 'webui/js/status.js' %}"></script>
{% endblock %}

{% block content %}
{% verbatim %}
<script id="liquidsoap-status-template" type="text/x-handlebars-template">
{{#if this}}
  <table>
    <caption>Harbor Sources</caption>
    <thead>
      <tr>
        <th width="25%">Precedence</th>
        <th width="30%">Source Name</th>
        <th width="50%">Active</th>
      </tr>
    </thead>
    <tbody>
      {{#each this}}
        {{#with this}}
          <tr{{#if current_stream}} class="green bold"{{/if}}>
            <td>{{precedence}}</td>
            <td>{{name}}</td>
            {{#if current_stream}}
              <td>Active &amp; streaming</td>
            {{else}}
              {{#if active}}
                <td class="orange">Active, not streaming (precedence too low)</td>
              {{else}}
                <td class="red">Inactive</td>
              {{/if}}
            {{/if}}
          </tr>
        {{/with}}
      {{/each}}
    </tbody>
  </table>
{{else}}
  <p class="error">The harbor appears to be down. Please wait.</p>
{{/if}}
</script>
{% endverbatim %}
<div id="liquidsoap-status"></div>

<table>
  <caption>Server Info</caption>
  {% for description, value in server_info %}
    <tr>
      <td><strong>{{ description }}</strong></td>
      <td>{{ value }}</td>
    </tr>
  {% endfor %}
</table>

<table>
  <caption>User</caption>
  {% for description, value in user_info %}
    <tr>
      <td><strong>{{ description }}</strong></td>
      <td>{{ value }}</td>
    </tr>
  {% endfor %}
</table>
</div>


{% if config.GOOGLE_CALENDAR_ENABLED and user.harbor_auth != user.HarborAuth.NEVER %}
  <details>
    <summary>
      {{ user.show_times|length }} Google Calendar show time{{ user.show_times|pluralize }}
      from {{ show_times_range_start }} to {{ show_times_range_end }}
    </summary>
    {% if user.harbor_auth == user.HarborAuth.ALWAYS %}
      <p><em>Note: you are <u>always</u> authorized to broadcast on the harbor.</em></p>
    {% endif %}
    {% if user.show_times %}
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Start Time</th>
            <th>End Time</th></tr>
        </thead>
        <tbody>
          {% for show_time in user.show_times %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ show_time.lower }}</td>
              <td>{{ show_time.upper }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No show times scheduled.</p>
    {% endif %}
  </details>
{% endif %}
{% endblock %}
